#include <tunables/global>

profile nrf52840_dfu_flasher flags=(attach_disconnected,mediate_deleted) {
  # Base
  #include <abstractions/base>

  ## --- s6-overlay & shells ---
  /init rix,
  /command/** rix,

  /bin/** rix,
  /sbin/** rix,
  /usr/bin/** rix,
  /usr/sbin/** rix,
  /usr/local/bin/** rix,
  /usr/local/sbin/** rix,
  /lib/** mr,
  /lib64/** mr,
  /usr/lib/** mr,
  /usr/local/lib/** mr,

  ## --- devices needed by init + serial ---
  /dev/null rw,
  /dev/urandom r,
  /dev/tty r,
  /dev/ptmx rw,
  /dev/pts/** rw,

  # USB serial devices
  /dev/ttyACM[0-9]* rw,
  /dev/ttyUSB[0-9]* rw,

  ## --- fs locations s6 & our scripts touch ---
  /proc/** r,
  /sys/** r,
  /run/** rwk,
  /tmp/** rwk,
  /data/** rwk,
  /share/** rwk,

  ## --- network (for fetching firmware) ---
  network,

  ## --- our scripts (read/exec permitted above already) ---
  /usr/bin/flash_nrfutil.sh r,
  /usr/bin/pick_asset.sh r,

  ## Default deny everything else (no write/lock/execute)
  deny /** wklx,
}
